<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Manager - Prototyp</title>
    <style>
        :root {
            --dark-green: #0a290a;
            --mid-green: #145214;
            --light-green: #2eb82e;
            --gold: #ffd700;       /* Nag≈Ç√≥wki */
            --black: #000000;
            --danger: #cc0000;
            --warn: #ffcc00;       /* Nowy, bardziej z≈Çoty kolor dla "Nie wiem" */
            --text-main: #e0e0e0;
        }

        * {
            box-sizing: border-box; /* Kluczowe dla responsywno≈õci */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--black);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .app-container {
            width: 100%;
            max-width: 500px;
            background: linear-gradient(180deg, var(--dark-green) 0%, var(--black) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
        }

        /* Header */
        header {
            background-color: var(--dark-green);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--gold);
        }

        h1 {
            margin: 0;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 1.5rem;
        }

        /* Views */
        .view {
            display: none; /* Domy≈õlnie ukryte */
            padding: 20px;
            flex: 1;
        }

        .view.active {
            display: flex;
            flex-direction: column;
            gap: 15px;
            animation: fadeIn 0.3s ease-in;
        }

        /* Login Panel */
        .login-btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .role-btn {
            flex: 1;
            padding: 15px;
            background: var(--mid-green);
            border: 1px solid var(--light-green);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .role-btn.selected {
            background: var(--gold);
            color: var(--black);
            border-color: var(--gold);
        }

        input[type="text"], input[type="password"], input[type="date"], input[type="time"] {
            width: 100%;
            padding: 12px;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--mid-green);
            color: white;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .action-btn {
            width: 100%;
            padding: 15px;
            background: var(--light-green);
            color: var(--black);
            border: none;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            text-transform: uppercase;
            border-radius: 5px;
            margin-top: 10px;
        }

        .action-btn:hover {
            background: var(--gold);
        }

        /* Cards */
        .training-card {
            background: rgba(20, 82, 20, 0.4);
            border-left: 4px solid var(--gold);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .training-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .training-date {
            color: var(--gold);
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* Coach Stats Section */
        .stats-summary {
            display: flex;
            justify-content: space-between; /* Lepsze roz≈Ço≈ºenie na ma≈Çych ekranach */
            gap: 5px;
            background: rgba(0,0,0,0.6);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }

        .stat-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1; /* R√≥wne szeroko≈õci kolumn */
        }

        .stat-count {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #aaa;
            margin-top: 2px;
        }

        .color-yes { color: var(--light-green); }
        .color-no { color: var(--danger); }
        .color-maybe { color: var(--warn); }

        /* Attendance Buttons */
        .attendance-options {
            display: flex;
            gap: 8px; /* Odrobinƒô wiƒôkszy odstƒôp */
            margin-top: 10px;
        }

        .att-btn {
            flex: 1;
            padding: 12px 5px; /* Wiƒôksze pole dotyku dla palca */
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            border-radius: 4px;
            opacity: 0.7;
            text-transform: uppercase;
            font-weight: 600;
            transition: all 0.2s;
        }

        .att-btn.active {
            opacity: 1;
            font-weight: 800;
            transform: scale(1.02);
            box-shadow: 0 0 8px rgba(255,255,255,0.3);
            border: 1px solid white; /* Wyra≈∫niejsze zaznaczenie */
        }

        .btn-yes { background-color: var(--light-green); color: black; }
        .btn-no { background-color: var(--danger); color: white; }
        .btn-maybe { background-color: var(--warn); color: black; }

        /* Notes & Inputs */
        .note-input {
            width: 100%;
            margin-top: 10px;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border: 1px solid #444;
            color: #ccc;
            font-size: 0.8rem;
            border-radius: 4px;
        }

        .player-note-display {
            font-size: 0.75rem;
            color: #aaa;
            font-style: italic;
            margin-top: 2px;
        }

        /* Coach Stats Details */
        .stats-list {
            font-size: 0.9rem;
            margin-top: 10px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .stats-list.expanded {
            max-height: 500px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Wyr√≥wnanie do ≈õrodka */
            border-bottom: 1px solid #333;
            padding: 8px 0; /* Wiƒôkszy odstƒôp dla czytelno≈õci */
        }

        .stat-item-info {
            display: flex;
            flex-direction: column;
        }

        .toggle-details-btn {
            background: none;
            border: 1px solid #444;
            color: #aaa;
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* Utility */
        .logout-link {
            text-align: center;
            color: #666;
            margin-top: 20px;
            cursor: pointer;
            text-decoration: underline;
            padding: 10px; /* ≈Åatwiej trafiƒá palcem */
        }
        
        /* Sekcja zarzƒÖdzania graczami (Lista) */
        .admin-panel {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px dashed #333;
        }

        .player-manage-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            border-left: 2px solid var(--mid-green);
        }

        .player-manage-item button {
            background: var(--danger);
            color: white;
            border: none;
            padding: 6px 12px;
            font-size: 0.75rem;
            cursor: pointer;
            border-radius: 3px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1>Team Planer</h1>
        <div id="user-display" style="font-size: 0.8rem; color: #888; margin-top: 5px;"></div>
    </header>

    <!-- VIEW 1: LOGIN -->
    <div id="view-login" class="view active">
        <h2 style="color: var(--light-green); text-align: center;">Kto wbija?</h2>
        
        <div class="login-btn-group">
            <button class="role-btn" onclick="selectRole('player', this)">ZAWODNIK</button>
            <button class="role-btn" onclick="selectRole('coach', this)">TRENER</button>
        </div>

        <input type="text" id="username-input" placeholder="Wpisz imiƒô / ksywƒô">
        
        <input type="password" id="user-code" placeholder="PIN dostƒôpu">
        
        <button class="action-btn" onclick="login()">Wchodzƒô</button>
    </div>

    <!-- VIEW 2: COACH DASHBOARD -->
    <div id="view-coach" class="view">
        <h3 style="border-bottom: 1px solid var(--mid-green); padding-bottom: 5px;">Dodaj Trening</h3>
        <input type="date" id="new-date">
        <input type="time" id="new-time">
        <input type="text" id="new-desc" placeholder="Opis (np. Si≈Çka, Murawa, Bieganie)">
        <button class="action-btn" onclick="addTraining()">Dodaj do kalendarza</button>

        <h3 style="margin-top: 30px;">Raport Trenera</h3>
        <div id="coach-list"></div> <!-- Lista generowana przez JS -->
        
        <!-- NOWA SEKCJA: ZARZƒÑDZANIE DRU≈ªYNƒÑ -->
        <div class="admin-panel">
            <h3 style="color: var(--gold); font-size: 1rem;">ZarzƒÖdzanie Dru≈ºynƒÖ</h3>
            
            <div style="margin-bottom: 15px;">
                <p style="font-size: 0.8rem; color: #888; margin-bottom: 10px;">Dodaj nowego zawodnika:</p>
                <input type="text" id="new-player-name" placeholder="Ksywa zawodnika">
                <input type="text" id="new-player-pin" placeholder="Nadaj PIN (np. 1234)">
                <button class="action-btn" onclick="addNewPlayer()" style="background-color: var(--mid-green); border: 1px solid var(--gold); color: white;">Dodaj Zawodnika</button>
            </div>

            <p style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">Lista zawodnik√≥w:</p>
            <div id="active-players-list"></div>
        </div>

        <div class="logout-link" onclick="logout()">Wyloguj</div>
    </div>

    <!-- VIEW 3: PLAYER DASHBOARD -->
    <div id="view-player" class="view">
        <h3 style="color: var(--gold);">NadchodzƒÖce Treningi</h3>
        <div id="player-list"></div> <!-- Lista generowana przez JS -->

        <div class="logout-link" onclick="logout()">Wyloguj</div>
    </div>

</div>

<script>
    // --- GLOBALNA OBS≈ÅUGA B≈ÅƒòD√ìW (Dla unhandled exceptions) ---
    window.onerror = function(message, source, lineno, colno, error) {
        console.error("KRYTYCZNY B≈ÅƒÑD:", message, error);
        alert("WystƒÖpi≈Ç b≈ÇƒÖd aplikacji: " + message + ". Od≈õwie≈º stronƒô.");
        return true; // Zapobiega domy≈õlnej obs≈Çudze (opcjonalne)
    };

    // --- STATIC DATABASE (DEFAULTS) ---
    const DEFAULT_USERS = {
        "maslo": "1919",
        "czaja": "1212",
        "test": "1234", // NOWY USER TESTOWY
        "dawid": "2356" // Trener
    };

    // --- DANE POCZƒÑTKOWE ---
    const INITIAL_TRAININGS = [
        { id: 1, date: "2026-02-01", time: "18:00", desc: "Trening Biegowy - Stadion" },
        { id: 2, date: "2026-02-03", time: "19:30", desc: "Si≈Çownia + Sauna" }
    ];

    // --- STATE MANAGEMENT ---
    let savedData = localStorage.getItem('teamAppData');
    let appData;

    try {
        if (savedData) {
            appData = JSON.parse(savedData);
            if (!appData.users) {
                appData.users = DEFAULT_USERS;
            }
            // Inicjalizacja notatek, je≈õli stara wersja ich nie ma
            if (!appData.notes) {
                appData.notes = {};
            }
        } else {
            appData = {
                users: DEFAULT_USERS,
                trainings: INITIAL_TRAININGS,
                attendance: {},
                notes: {} // Nowy obiekt na notatki
            };
            localStorage.setItem('teamAppData', JSON.stringify(appData));
        }
    } catch (e) {
        console.error("B≈ÇƒÖd ≈Çadowania danych startowych:", e);
        alert("B≈ÇƒÖd danych! Aplikacja zresetuje ustawienia.");
        localStorage.removeItem('teamAppData');
        location.reload();
    }

    let currentUser = null; 
    let expandedCards = new Set(); // Pamiƒôtamy, kt√≥re karty sƒÖ rozwiniƒôte

    // --- AUTOMATYCZNE OD≈öWIE≈ªANIE (AUTO-SYNC) ---
    // Sprawdzamy co 10 sekund, czy dane w localStorage siƒô zmieni≈Çy
    setInterval(() => {
        try {
            if (!currentUser) return; // Dzia≈Ça tylko jak kto≈õ jest zalogowany

            const currentString = localStorage.getItem('teamAppData');
            // Je≈õli dane na dysku sƒÖ inne ni≈º te, kt√≥re mamy za≈Çadowane...
            if (currentString && currentString !== JSON.stringify(appData)) {
                // UWAGA: Nie od≈õwie≈ºamy je≈õli u≈ºytkownik jest w trakcie pisania (focus na input)
                // Proste sprawdzenie czy aktywny element to input
                if (document.activeElement && document.activeElement.tagName === 'INPUT') {
                    console.log("Wstrzymano od≈õwie≈ºanie - u≈ºytkownik pisze...");
                    return;
                }

                console.log("Wykryto zmianƒô danych! Od≈õwie≈ºam widok...");
                appData = JSON.parse(currentString); // Aktualizujemy pamiƒôƒá
                
                // Od≈õwie≈ºamy widok zale≈ºnie od roli
                if (currentUser.role === 'coach') {
                    renderCoachList();
                    renderPlayerManagement();
                } else {
                    renderPlayerList();
                }
            }
        } catch (error) {
            console.error("B≈ÇƒÖd synchronizacji (Auto-Sync):", error);
        }
    }, 10000); // Interwa≈Ç: 10000ms = 10 sekund

    function saveData() {
        try {
            localStorage.setItem('teamAppData', JSON.stringify(appData));
        } catch (e) {
            console.error("B≈ÇƒÖd zapisu danych:", e);
            alert("Nie uda≈Ço siƒô zapisaƒá zmian! Sprawd≈∫ pamiƒôƒá urzƒÖdzenia.");
        }
    }

    // --- NAVIGATION & SECURITY ---
    let selectedRole = '';

    function selectRole(role, btnElement) {
        selectedRole = role;
        document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('selected'));
        btnElement.classList.add('selected');
    }

    function login() {
        try {
            // Przed logowaniem zawsze pobierz naj≈õwie≈ºsze dane
            const freshData = localStorage.getItem('teamAppData');
            if (freshData) appData = JSON.parse(freshData);

            const nameInput = document.getElementById('username-input').value.trim().toLowerCase(); 
            const codeInput = document.getElementById('user-code').value.trim();

            if (!selectedRole) return alert("Wybierz: Trener czy Zawodnik?");
            if (!nameInput) return alert("Podaj imiƒô!");
            if (!codeInput) return alert("Podaj PIN!");

            // ZABEZPIECZENIE: Sprawdzamy, czy kto≈õ nie pr√≥buje wej≈õƒá na trenera nie bƒôdƒÖc Dawidem
            if (selectedRole === 'coach' && nameInput !== 'dawid') {
                return alert("B≈ÅƒÑD DOSTƒòPU: Tylko Trener Dawid ma dostƒôp do tego panelu! Je≈õli jeste≈õ zawodnikiem, zmie≈Ñ przycisk na g√≥rze.");
            }

            const validPin = appData.users[nameInput];

            if (validPin) {
                if (validPin === codeInput) {
                    // SUKCES
                    currentUser = { name: nameInput, role: selectedRole };
                    proceedLogin();
                } else {
                    alert("B≈Çƒôdny PIN!");
                }
            } else {
                alert("Nie ma takiego zawodnika w bazie.");
            }
        } catch (e) {
            console.error("B≈ÇƒÖd logowania:", e);
            alert("WystƒÖpi≈Ç b≈ÇƒÖd podczas logowania.");
        }
    }

    function proceedLogin() {
        const displayName = currentUser.name.charAt(0).toUpperCase() + currentUser.name.slice(1);
        
        document.getElementById('user-display').innerText = `Zalogowano jako: ${displayName}`;
        document.getElementById('view-login').classList.remove('active');
        
        document.getElementById('username-input').value = '';
        document.getElementById('user-code').value = '';

        if (currentUser.role === 'coach') {
            document.getElementById('view-coach').classList.add('active');
            renderCoachList();
            renderPlayerManagement(); 
        } else {
            document.getElementById('view-player').classList.add('active');
            renderPlayerList();
        }
    }

    function logout() {
        currentUser = null;
        expandedCards.clear(); // Czy≈õcimy stan rozwiniƒôcia przy wylogowaniu
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-login').classList.add('active');
        document.getElementById('user-display').innerText = '';
    }

    // --- COACH LOGIC ---
    function addTraining() {
        const date = document.getElementById('new-date').value;
        const time = document.getElementById('new-time').value;
        const desc = document.getElementById('new-desc').value;

        if(!date || !time || !desc) return alert("Wype≈Çnij wszystkie pola!");

        const newTraining = {
            id: Date.now(),
            date: date,
            time: time,
            desc: desc
        };

        appData.trainings.push(newTraining);
        appData.attendance[newTraining.id] = {};
        appData.notes[newTraining.id] = {}; // Inicjalizacja notatek dla treningu
        saveData();
        renderCoachList();
        
        document.getElementById('new-desc').value = '';
    }
    
    // ZARZƒÑDZANIE GRACZAMI
    function addNewPlayer() {
        const newName = document.getElementById('new-player-name').value.trim().toLowerCase();
        const newPin = document.getElementById('new-player-pin').value.trim();

        if(!newName || !newPin) return alert("Podaj nazwƒô i PIN!");

        if(appData.users[newName]) {
            return alert("Taki zawodnik ju≈º istnieje!");
        }

        appData.users[newName] = newPin;
        saveData();
        renderPlayerManagement(); 
        
        // Czy≈õcimy pola
        document.getElementById('new-player-name').value = '';
        document.getElementById('new-player-pin').value = '';
    }

    function renderPlayerManagement() {
        const listContainer = document.getElementById('active-players-list');
        listContainer.innerHTML = '';

        // Pobieramy wszystkich user√≥w opr√≥cz trenera (Dawida)
        const players = Object.keys(appData.users).filter(u => u !== 'dawid');

        if (players.length === 0) {
            listContainer.innerHTML = '<div style="color:#666; font-size:0.8rem; text-align:center;">Brak zawodnik√≥w w bazie</div>';
            return;
        }

        players.forEach(p => {
            const dispName = p.charAt(0).toUpperCase() + p.slice(1);
            listContainer.innerHTML += `
                <div class="player-manage-item">
                    <span>${dispName}</span>
                    <button onclick="deletePlayer('${p}')">USU≈É</button>
                </div>
            `;
        });
    }

    function deletePlayer(playerName) {
        if(confirm(`Czy na pewno usunƒÖƒá zawodnika ${playerName} z bazy? Nie bƒôdzie m√≥g≈Ç siƒô zalogowaƒá.`)) {
            delete appData.users[playerName];
            saveData();
            renderPlayerManagement();
        }
    }

    function renderCoachList() {
        const container = document.getElementById('coach-list');
        container.innerHTML = '';

        const sorted = appData.trainings.sort((a,b) => new Date(b.date) - new Date(a.date));

        sorted.forEach(t => {
            const att = appData.attendance[t.id] || {};
            const notes = appData.notes ? (appData.notes[t.id] || {}) : {};
            
            let countYes = 0, countNo = 0, countMaybe = 0;
            let listHTML = '';

            for (const [player, status] of Object.entries(att)) {
                if(status === 'yes') countYes++;
                if(status === 'no') countNo++;
                if(status === 'maybe') countMaybe++;

                let color = status === 'yes' ? 'var(--light-green)' : (status === 'no' ? 'var(--danger)' : 'var(--warn)');
                let icon = status === 'yes' ? '‚úÖ' : (status === 'no' ? '‚ùå' : '‚ùì');
                
                const dispName = player.charAt(0).toUpperCase() + player.slice(1);
                
                // Pobieramy notatkƒô gracza, je≈õli istnieje
                const playerNote = notes[player] ? `<span class="player-note-display">üìù ${notes[player]}</span>` : '';

                listHTML += `<div class="stat-item">
                                <div class="stat-item-info">
                                    <span>${dispName}</span>
                                    ${playerNote}
                                </div>
                                <span style="color:${color}; font-weight:bold;">${icon}</span>
                             </div>`;
            }

            const totalVotes = countYes + countNo + countMaybe;
            const presenceRate = totalVotes > 0 ? Math.round((countYes / totalVotes) * 100) : 0;

            // Sprawdzamy czy ta karta ma byƒá rozwiniƒôta
            const isExpanded = expandedCards.has(t.id) ? 'expanded' : '';

            container.innerHTML += `
                <div class="training-card">
                    <div class="training-header">
                        <span class="training-date">${t.date} | ${t.time}</span>
                        <button onclick="deleteTraining(${t.id})" style="color:#666; background:none; border:none; cursor:pointer;">X</button>
                    </div>
                    <div style="font-size: 1.1rem; margin-bottom: 10px;">${t.desc}</div>
                    
                    <div class="stats-summary">
                        <div class="stat-box color-yes">
                            <span class="stat-count">${countYes}</span>
                            <span class="stat-label">Bƒôdzie</span>
                        </div>
                        <div class="stat-box color-maybe">
                            <span class="stat-count">${countMaybe}</span>
                            <span class="stat-label">Nie wiem</span>
                        </div>
                        <div class="stat-box color-no">
                            <span class="stat-count">${countNo}</span>
                            <span class="stat-label">Odpada</span>
                        </div>
                        <div class="stat-box" style="border-left: 1px solid #444; padding-left: 10px;">
                            <span class="stat-count" style="color:white;">${presenceRate}%</span>
                            <span class="stat-label">Frekwencja</span>
                        </div>
                    </div>

                    <button class="toggle-details-btn" onclick="toggleDetails(${t.id})">Poka≈º/Ukryj listƒô nazwisk</button>
                    <div class="stats-list ${isExpanded}">
                        ${listHTML || '<div style="text-align:center; color:#666;">Brak g≈Ços√≥w</div>'}
                    </div>
                </div>
            `;
        });
    }

    function toggleDetails(id) {
        if (expandedCards.has(id)) {
            expandedCards.delete(id);
        } else {
            expandedCards.add(id);
        }
        renderCoachList(); 
    }

    function deleteTraining(id) {
        if(confirm("UsunƒÖƒá ten trening?")) {
            appData.trainings = appData.trainings.filter(t => t.id !== id);
            delete appData.attendance[id];
            delete appData.notes[id]; // Usuwamy te≈º notatki
            saveData();
            renderCoachList();
        }
    }

    // --- PLAYER LOGIC ---
    function renderPlayerList() {
        const container = document.getElementById('player-list');
        container.innerHTML = '';

        const sorted = appData.trainings.sort((a,b) => new Date(a.date) - new Date(b.date));

        if (sorted.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#666;">Brak plan√≥w w bazie.</p>';
            return;
        }

        sorted.forEach(t => {
            const myStatus = appData.attendance[t.id] ? appData.attendance[t.id][currentUser.name] : null;
            // Pobieramy istniejƒÖcƒÖ notatkƒô
            const myNote = (appData.notes && appData.notes[t.id] && appData.notes[t.id][currentUser.name]) || '';

            container.innerHTML += `
                <div class="training-card">
                    <div class="training-header">
                        <span class="training-date">${t.date} ${t.time}</span>
                    </div>
                    <div style="font-size: 1.2rem; margin-bottom: 15px;">${t.desc}</div>
                    
                    <div class="attendance-options">
                        <button class="att-btn btn-yes ${myStatus === 'yes' ? 'active' : ''}" onclick="setAttendance(${t.id}, 'yes')">BƒòDƒò</button>
                        <button class="att-btn btn-maybe ${myStatus === 'maybe' ? 'active' : ''}" onclick="setAttendance(${t.id}, 'maybe')">NIE WIEM</button>
                        <button class="att-btn btn-no ${myStatus === 'no' ? 'active' : ''}" onclick="setAttendance(${t.id}, 'no')">ODPADAM</button>
                    </div>
                    
                    <!-- NOWE POLE NOTATKI -->
                    <input type="text" 
                           class="note-input" 
                           placeholder="Notatka dla trenera (np. sp√≥≈∫niƒô siƒô 10min)" 
                           value="${myNote}" 
                           oninput="saveNote(${t.id}, this)">
                </div>
            `;
        });
    }

    function setAttendance(trainingId, status) {
        const freshData = localStorage.getItem('teamAppData');
        if (freshData) appData = JSON.parse(freshData);

        if (!appData.attendance[trainingId]) {
            appData.attendance[trainingId] = {};
        }
        appData.attendance[trainingId][currentUser.name] = status;
        saveData();
        renderPlayerList();
    }

    function saveNote(trainingId, inputElement) {
        // Zapisujemy notatkƒô w czasie rzeczywistym
        if (!appData.notes) appData.notes = {};
        if (!appData.notes[trainingId]) appData.notes[trainingId] = {};
        
        appData.notes[trainingId][currentUser.name] = inputElement.value;
        saveData();
    }

</script>

</body>
</html>
